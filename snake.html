<!DOCTYPE html>
<html>
<head>
	<title>Atte Piltonen BrowserSnake</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="style.css">
	<style>
		#game-board {
			position: relative;
			height: 300px;
			width: 300px;
			border: 1px solid black;
		}
		.dot {
			position: absolute;
			height: 20px;
			width: 20px;
			background-color: #000;
		}
		.apple {
			position: absolute;
			height: 20px;
			width: 20px;
			background-color: #f00;
		}
	</style>
</head>
<body>
	<nav class="navbar navbar-expand-md bg-dark navbar-dark">
		<a class="navbar-brand" href="index.html">Atte Piltonen</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="collapsibleNavbar">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" href="index.html">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="publications.html">Publications</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="snake.html">BrowserSnake</a>
				</li>
			</ul>
		</div>
	</nav>
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<h1>BrowserSnake</h1>
				<div id="game-board"></div>
			</div>
		</div>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script>
		var dotSize = 20;
		var gameSpeed = 200;
		var direction = 'right';
		var snake = [{ top: 0, left: 0 }];
		var apple = null;
		var gameBoardSize = 300; // same as the #game-board size in CSS

		function updateGame() {
			var head = Object.assign({}, snake[0]); // copy head
			switch(direction) {
				case 'left':
					head.left -= dotSize;
					break;
				case 'up':
					head.top -= dotSize;
					break;
				case 'right':
					head.left += dotSize;
					break;
				case 'down':
					head.top += dotSize;
					break;
			}

			// Screen wrapping
			if(head.left < 0) {
				head.left = gameBoardSize - dotSize;
			} else if(head.left === gameBoardSize) {
				head.left = 0;
			} else if(head.top < 0) {
				head.top = gameBoardSize - dotSize;
			} else if(head.top === gameBoardSize) {
				head.top = 0;
			}

			snake.unshift(head);

			if (apple && apple.left === head.left && apple.top === head.top) { // eat the apple
				apple = null;
			} else {
				snake.pop(); // remove the tail
			}

			if (!apple) { // create new apple
				apple = {
					left: Math.floor(Math.random() * (gameBoardSize / dotSize)) * dotSize,
					top: Math.floor(Math.random() * (gameBoardSize / dotSize)) * dotSize,
				}
			}

			// draw the game
			var gameBoard = document.getElementById('game-board');
			gameBoard.innerHTML = '';
			snake.forEach(function(dot) {
				var dotElem = document.createElement('div');
				dotElem.className = 'dot';
				dotElem.style.left = `${dot.left}px`;
				dotElem.style.top = `${dot.top}px`;
				gameBoard.appendChild(dotElem);
			});

			var appleElem = document.createElement('div');
			appleElem.className = 'apple';
			appleElem.style.left = `${apple.left}px`;
			appleElem.style.top = `${apple.top}px`;
			gameBoard.appendChild(appleElem);
		}

		setInterval(updateGame, gameSpeed);

		window.addEventListener('keydown', function(e) {
			switch(e.key) {
				case 'ArrowUp':
					direction = 'up';
					break;
				case 'ArrowDown':
					direction = 'down';
					break;
				case 'ArrowLeft':
					direction = 'left';
					break;
				case 'ArrowRight':
					direction = 'right';
					break;
			}
		});
	</script>
</body>
</html>
